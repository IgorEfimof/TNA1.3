<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TT Analyzer 4.0</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
:root{
--bg:#0a0b10;
--card:#151821;
--accent:#2563eb;
--good:#22c55e;
--warn:#f59e0b;
--bad:#ef4444;
--text:#e5e7eb;
--muted:#9ca3af;
}

*{
box-sizing:border-box;
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
}

body{
margin:0;
background:var(--bg);
color:var(--text);
}

.container{
max-width:430px;
margin:auto;
padding:14px;
}

h1{
text-align:center;
font-size:22px;
margin-bottom:12px;
}

.card{
background:var(--card);
border-radius:16px;
padding:16px;
margin-bottom:14px;
}

.upload{
background:var(--accent);
color:#fff;
padding:14px;
text-align:center;
border-radius:12px;
font-size:16px;
cursor:pointer;
}

input[type=file]{display:none;}

input[type=number]{
width:100%;
padding:12px;
border-radius:10px;
border:none;
margin-top:8px;
font-size:15px;
}

.status{
text-align:center;
font-size:13px;
color:var(--muted);
margin-top:6px;
}

.row{
display:flex;
justify-content:space-between;
padding:6px 0;
border-bottom:1px solid #222;
font-size:14px;
}

.row:last-child{border:none;}

.tag{
padding:4px 10px;
border-radius:999px;
font-size:12px;
}

.good{background:rgba(34,197,94,.15);color:var(--good);}
.warn{background:rgba(245,158,11,.15);color:var(--warn);}
.bad{background:rgba(239,68,68,.15);color:var(--bad);}

.block{
margin-top:12px;
padding:14px;
border-radius:12px;
}

.forecast{background:#0f1d38;border-left:4px solid var(--accent);}
.decision-good{background:rgba(34,197,94,.12);}
.decision-warn{background:rgba(245,158,11,.12);}
.decision-bad{background:rgba(239,68,68,.12);}
</style>
</head>

<body>
<div class="container">

<h1>üèì TT Analyzer 4.0</h1>

<div class="card">
<label class="upload">
üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç
<input type="file" accept="image/*" onchange="analyze(event)">
</label>
<div class="status" id="status"></div>
</div>

<div class="card">
<label>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –±—É–∫–º–µ–∫–µ—Ä–∞</label>
<input type="number" step="0.01" id="odds" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 1.85">
</div>

<div class="card" id="output">
–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
</div>

</div>

<script>
let lastStats=null;

function analyze(e){
const status=document.getElementById('status');
status.innerText='‚è≥ OCR...';

Tesseract.recognize(
e.target.files[0],
'rus',
{logger:m=>status.innerText=`‚è≥ ${Math.round(m.progress*100)}%`}
).then(r=>{
status.innerText='‚úÖ –ì–æ—Ç–æ–≤–æ';
parseText(r.data.text);
});
}

function parseText(text){
const lines=text.split('\n').map(l=>l.trim()).filter(l=>l);
let matches=[];

lines.forEach(l=>{
if(l.includes('(')&&l.match(/\d:\d/))matches.push(l);
});

let total=matches.length;
if(total<5){
document.getElementById('output').innerHTML='‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö';
return;
}

let sets=0,points=0,five=0,s30=0,s31=0,s32=0;

matches.forEach(m=>{
let score=m.match(/(\d)\s*:\s*(\d)/);
let arr=m.match(/\((.*?)\)/)[1].split(',');
sets+=arr.length;
if(arr.length===5)five++;

if(score[1]==3&&score[2]==0)s30++;
if(score[1]==3&&score[2]==1)s31++;
if(score[1]==3&&score[2]==2)s32++;

arr.forEach(s=>{
let n=s.match(/(\d+)\s*:\s*(\d+)/);
if(n)points+=Number(n[1])+Number(n[2]);
});
});

let avgSets=sets/total;
let volatility=s32/total*100;
let mbi=Math.min(100,Math.max(0,(avgSets-3)*40 + (five/total)*20));

lastStats={avgSets,volatility,mbi,total};

render();
}

function render(){
const o=document.getElementById('odds').value;
let implied=o? (1/o*100):0;
let edge=lastStats.mbi-implied;

let decision='‚ùå –ü–†–û–ü–£–°–¢–ò–¢–¨';
let cls='decision-bad';

if(lastStats.total>=8 && edge>5){
decision='‚úÖ –°–¢–ê–í–ò–¢–¨';
cls='decision-good';
}else if(edge>0){
decision='‚ö†Ô∏è –û–°–¢–û–†–û–ñ–ù–û';
cls='decision-warn';
}

document.getElementById('output').innerHTML=`
<div class="row"><span>–ú–∞—Ç—á–µ–π</span><b>${lastStats.total}</b></div>
<div class="row"><span>–°—Ä–µ–¥–Ω–µ–µ —Å–µ—Ç–æ–≤</span><b>${lastStats.avgSets.toFixed(2)}</b></div>
<div class="row"><span>–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å</span><b>${lastStats.volatility.toFixed(1)}%</b></div>
<div class="row"><span>Market Bias Index</span><b>${lastStats.mbi.toFixed(1)}</b></div>

<div class="block forecast">
<b>Value-–∞–Ω–∞–ª–∏–∑</b><br>
–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞: ${implied.toFixed(1)}%<br>
–û–∂–∏–¥–∞–µ–º–∞—è: ${lastStats.mbi.toFixed(1)}%<br>
Value: ${(edge).toFixed(1)}%
</div>

<div class="block ${cls}">
<b>–†–µ—à–µ–Ω–∏–µ:</b> ${decision}
</div>
`;
}
</script>

</body>
</html>

