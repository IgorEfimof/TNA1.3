<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TT Analyzer 11.0 ‚Äî Trading Desk</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
:root{
--bg:#05060b;
--card:#111425;
--accent:#2563eb;
--good:#22c55e;
--warn:#f59e0b;
--bad:#ef4444;
--text:#e5e7eb;
--muted:#9ca3af;
}

*{
box-sizing:border-box;
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
}

body{
margin:0;
background:var(--bg);
color:var(--text);
}

.container{
max-width:500px;
margin:auto;
padding:14px;
}

h1{
text-align:center;
font-size:22px;
margin-bottom:10px;
}

.card{
background:var(--card);
border-radius:16px;
padding:16px;
margin-bottom:14px;
}

button{
width:100%;
padding:12px;
border-radius:10px;
border:none;
margin-top:8px;
font-size:15px;
cursor:pointer;
}

.btn-good{background:var(--good);color:#000;}
.btn-warn{background:var(--warn);color:#000;}

.row{
display:flex;
justify-content:space-between;
padding:6px 0;
border-bottom:1px solid #222;
font-size:14px;
}

.block{
margin-top:10px;
padding:12px;
border-radius:12px;
}

.good{background:rgba(34,197,94,.12);}
.warn{background:rgba(245,158,11,.12);}
.bad{background:rgba(239,68,68,.12);}

canvas{
width:100%;
height:200px;
background:#0b0d18;
border-radius:12px;
}
</style>
</head>

<body>
<div class="container">

<h1>üèì TT Analyzer 11.0</h1>

<div class="card">
<button class="btn-good" onclick="startCapture()">üì∏ Start Auto-Capture</button>
<button class="btn-warn" onclick="stopCapture()">‚èπ Stop Capture</button>
</div>

<div class="card" id="output">
–û–∂–∏–¥–∞–Ω–∏–µ –ª–∏–Ω–∏–∏
</div>

<div class="card">
<div class="block">
<b>üì¶ –ü–æ—Ä—Ç—Ñ–µ–ª—å –º–∞—Ç—á–µ–π</b>
<div id="portfolio"></div>
</div>
</div>

<div class="card">
<div class="block">
<b>üî• Heatmap —Ä—ã–Ω–∫–∞</b>
<canvas id="heatmap"></canvas>
</div>
</div>

</div>

<script>
let captureInterval=null;
let portfolio=[];
let heatData=[];

// === AUTO SCREEN CAPTURE ===
async function startCapture(){
const stream=await navigator.mediaDevices.getDisplayMedia({video:true});
const track=stream.getVideoTracks()[0];
const imageCapture=new ImageCapture(track);

captureInterval=setInterval(async()=>{
const bitmap=await imageCapture.grabFrame();
runOCR(bitmap);
},5000);
}

function stopCapture(){
clearInterval(captureInterval);
}

// === OCR PIPELINE ===
function runOCR(bitmap){
const canvas=document.createElement('canvas');
canvas.width=bitmap.width;
canvas.height=bitmap.height;
canvas.getContext('2d').drawImage(bitmap,0,0);

Tesseract.recognize(canvas,'rus').then(r=>{
analyzeLine(r.data.text);
});
}

// === LINE ANALYSIS ===
function analyzeLine(text){
const odds=text.match(/\d\.\d{2}/g);
if(!odds||odds.length<10) return;

const nums=odds.map(Number);
let edge=Math.abs(nums[3]-nums[2])*nums[2];
let variance=edge<0.6?'HIGH':edge<1?'MEDIUM':'LOW';

let trade={
time:new Date().toLocaleTimeString(),
edge:edge.toFixed(2),
variance
};

portfolio.push(trade);
heatData.push(edge);

renderPortfolio();
drawHeatmap();
}

// === PORTFOLIO ===
function renderPortfolio(){
const el=document.getElementById('portfolio');
el.innerHTML='';
portfolio.slice(-5).forEach(t=>{
el.innerHTML+=`
<div class="row">
<span>${t.time}</span>
<b>${t.edge} | ${t.variance}</b>
</div>`;
});
}

// === HEATMAP ===
function drawHeatmap(){
const c=document.getElementById('heatmap');
const ctx=c.getContext('2d');
ctx.clearRect(0,0,c.width,c.height);

heatData.slice(-20).forEach((v,i)=>{
let x=i*(c.width/20);
let intensity=Math.min(1,v/2);
ctx.fillStyle=`rgba(34,197,94,${intensity})`;
ctx.fillRect(x,0,c.width/20,c.height);
});
}
</script>

</body>
</html>
