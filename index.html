<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TT Analyzer 3.0</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
:root {
    --bg:#0b0c10;
    --card:#161821;
    --accent:#2563eb;
    --good:#22c55e;
    --warn:#f59e0b;
    --bad:#ef4444;
    --text:#e5e7eb;
    --muted:#9ca3af;
}

* {
    box-sizing:border-box;
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
}

body {
    margin:0;
    background:var(--bg);
    color:var(--text);
}

.container {
    max-width:430px;
    margin:auto;
    padding:14px;
}

h1 {
    text-align:center;
    font-size:22px;
    margin-bottom:12px;
}

.card {
    background:var(--card);
    border-radius:16px;
    padding:16px;
    margin-bottom:14px;
}

.upload {
    background:var(--accent);
    color:#fff;
    padding:14px;
    text-align:center;
    border-radius:12px;
    font-size:16px;
    cursor:pointer;
}

input { display:none; }

.status {
    text-align:center;
    margin-top:8px;
    font-size:13px;
    color:var(--muted);
}

.row {
    display:flex;
    justify-content:space-between;
    padding:6px 0;
    border-bottom:1px solid #222;
    font-size:14px;
}

.row:last-child { border:none; }

.tag {
    padding:4px 10px;
    border-radius:999px;
    font-size:12px;
}

.good { background:rgba(34,197,94,.15); color:var(--good); }
.warn { background:rgba(245,158,11,.15); color:var(--warn); }
.bad  { background:rgba(239,68,68,.15); color:var(--bad); }

.forecast {
    background:#0f1d38;
    border-left:4px solid var(--accent);
    padding:14px;
    border-radius:10px;
    margin-top:12px;
    font-size:14px;
    line-height:1.5;
}
</style>
</head>

<body>

<div class="container">
<h1>üèì TT Analyzer 3.0</h1>

<div class="card">
<label class="upload">
üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç
<input type="file" accept="image/*" onchange="analyze(event)">
</label>
<div class="status" id="status"></div>
</div>

<div class="card" id="output">
–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
</div>
</div>

<script>
function analyze(e) {
    const status = document.getElementById('status');
    const out = document.getElementById('output');
    out.innerHTML = '';
    status.innerText = '‚è≥ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞...';

    Tesseract.recognize(
        e.target.files[0],
        'rus',
        { logger:m => status.innerText = `‚è≥ ${Math.round(m.progress*100)}%` }
    ).then(res => {
        status.innerText = '‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω';
        parseText(res.data.text);
    });
}

function parseText(text) {
    const lines = text
        .replace(/\s+/g,' ')
        .split('\n')
        .map(l => l.trim())
        .filter(l => l);

    let matches = [];

    for (let i = 0; i < lines.length; i++) {
        if (lines[i].match(/\d:\d/) && lines[i].includes('(')) {
            matches.push(lines[i]);
        }
    }

    if (matches.length === 0) {
        document.getElementById('output').innerHTML =
            '<span class="bad">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –º–∞—Ç—á–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Å–∫—Ä–∏–Ω.</span>';
        return;
    }

    let total = matches.length;
    let s30=0, s31=0, s32=0;
    let sets=0, points=0, five=0;

    matches.forEach(m => {
        const score = m.match(/(\d)\s*:\s*(\d)/);
        const setsBlock = m.match(/\((.*?)\)/);
        if (!score || !setsBlock) return;

        const setArr = setsBlock[1].split(',');
        sets += setArr.length;
        if (setArr.length === 5) five++;

        if (score[1]==3 && score[2]==0) s30++;
        if (score[1]==3 && score[2]==1) s31++;
        if (score[1]==3 && score[2]==2) s32++;

        setArr.forEach(s => {
            const nums = s.match(/(\d+)\s*:\s*(\d+)/);
            if (nums) points += Number(nums[1]) + Number(nums[2]);
        });
    });

    const avgSets = (sets/total).toFixed(2);
    const avgPoints = (points/total).toFixed(1);
    const avgSetPoints = (points/sets).toFixed(1);

    const p30 = Math.round((s30/total)*100);
    const p31 = Math.round((s31/total)*100);
    const p32 = Math.round((s32/total)*100);
    const p4plus = Math.round(((s31+s32)/total)*100);
    const p5 = Math.round((five/total)*100);

    let profile, confidence, mainBet, altBet, riskyBet, avoid;

    if (avgSets >= 4.2) {
        profile = '–î–ª–∏–Ω–Ω–∞—è –ª–∏–≥–∞';
        mainBet = '–¢–ë –ø–æ —Å–µ—Ç–∞–º (3.5)';
        altBet = '–¢–ë –æ—á–∫–æ–≤';
        riskyBet = '5 —Å–µ—Ç–æ–≤ ‚Äî –î–∞';
        avoid = '–¢–ú —Å–µ—Ç–æ–≤, —Ç–æ—á–Ω—ã–π —Å—á—ë—Ç';
        confidence = Math.min(85, 60 + p4plus/2);
    } else if (avgSets >= 3.7) {
        profile = '–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è';
        mainBet = '–¢–ë 3.5 —Å–µ—Ç–æ–≤';
        altBet = '–ü–æ–±–µ–¥–∞ 3:1';
        riskyBet = '–¢–ë –æ—á–∫–æ–≤';
        avoid = '–ü–æ–±–µ–¥–∞ 3:0';
        confidence = 65;
    } else {
        profile = '–ö–æ—Ä–æ—Ç–∫–∞—è –ª–∏–≥–∞';
        mainBet = '–ü–æ–±–µ–¥–∞ 3:0 / 3:1';
        altBet = '–¢–ú —Å–µ—Ç–æ–≤ (3.5)';
        riskyBet = '–¢–ú –æ—á–∫–æ–≤';
        avoid = '5 —Å–µ—Ç–æ–≤';
        confidence = Math.min(80, 55 + p30);
    }

    document.getElementById('output').innerHTML = `
    <div class="row"><span>–ú–∞—Ç—á–µ–π</span><b>${total}</b></div>
    <div class="row"><span>–°—Ä–µ–¥–Ω–µ–µ —Å–µ—Ç–æ–≤</span><b>${avgSets}</b></div>
    <div class="row"><span>–°—Ä–µ–¥–Ω–∏–π —Ç–æ—Ç–∞–ª</span><b>${avgPoints}</b></div>
    <div class="row"><span>–û—á–∫–æ–≤ –≤ —Å–µ—Ç–µ</span><b>${avgSetPoints}</b></div>

    <div class="row"><span>3:0</span><b>${p30}%</b></div>
    <div class="row"><span>3:1</span><b>${p31}%</b></div>
    <div class="row"><span>3:2</span><b>${p32}%</b></div>
    <div class="row"><span>4+ —Å–µ—Ç–æ–≤</span><b>${p4plus}%</b></div>
    <div class="row"><span>5 —Å–µ—Ç–æ–≤</span><b>${p5}%</b></div>

    <div class="row">
        <span>–¢–∏–ø –ª–∏–Ω–∏–∏</span>
        <span class="tag good">${profile}</span>
    </div>

    <div class="forecast">
        ‚≠ê <b>–ü—Ä–æ–≥–Ω–æ–∑ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–∞–≤–∫–∏</b><br><br>
        <b>–û—Å–Ω–æ–≤–Ω–∞—è:</b> ${mainBet}<br>
        <b>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:</b> ${altBet}<br>
        <b>–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è:</b> ${riskyBet}<br><br>
        ‚ùå <b>–ò–∑–±–µ–≥–∞—Ç—å:</b> ${avoid}<br><br>
        üìä <b>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</b> ${confidence}%
    </div>
    `;
}
</script>

</body>
</html>
