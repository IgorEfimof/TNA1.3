<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TT Live Analyzer ‚Äî Ultimate</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
:root{
--bg:#05060b;
--card:#121526;
--accent:#2563eb;
--good:#22c55e;
--warn:#f59e0b;
--bad:#ef4444;
--text:#e5e7eb;
--muted:#9ca3af;
}

*{
box-sizing:border-box;
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
}

body{margin:0;background:var(--bg);color:var(--text);}
.container{max-width:460px;margin:auto;padding:14px;}
h1{text-align:center;font-size:22px;margin-bottom:12px;}

.card{
background:var(--card);
border-radius:16px;
padding:16px;
margin-bottom:14px;
}

.upload{
background:var(--accent);
color:#fff;
padding:14px;
border-radius:12px;
text-align:center;
font-size:16px;
cursor:pointer;
}

input[type=file]{display:none;}

.row{
display:flex;
justify-content:space-between;
padding:6px 0;
border-bottom:1px solid #222;
font-size:14px;
}
.row:last-child{border:none;}

.block{margin-top:12px;padding:14px;border-radius:12px;}
.good{background:rgba(34,197,94,.15);}
.warn{background:rgba(245,158,11,.15);}
.bad{background:rgba(239,68,68,.15);}

.highlight{font-size:16px;font-weight:600;margin-bottom:6px;}
.small{font-size:13px;color:var(--muted);}
.decision{font-size:20px;font-weight:700;text-align:center;margin-top:10px;}

button{
width:100%;
padding:12px;
border-radius:10px;
border:none;
margin-top:8px;
font-size:15px;
cursor:pointer;
}
.btn-good{background:var(--good);color:#000;}
.btn-bad{background:var(--bad);color:#fff;}
.btn-warn{background:var(--warn);color:#000;}
.btn-accent{background:var(--accent);color:#fff;}

canvas{width:100%!important;height:220px!important;}
</style>
</head>

<body>
<div class="container">

<h1>üèì TT Live Analyzer</h1>

<div class="card">
<label class="upload">
üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–Ω LIVE (–ø–æ—Å–ª–µ 1-–π –ø–∞—Ä—Ç–∏–∏)
<input type="file" accept="image/*" onchange="analyze(event)">
</label>
<div class="small" id="status"></div>
</div>

<div class="card" id="output">–û–∂–∏–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞</div>

<div class="card">
<div class="highlight">üìí –ñ—É—Ä–Ω–∞–ª —Å–¥–µ–ª–æ–∫</div>
<div id="tradeLog"></div>

<button class="btn-accent" onclick="exportCSV()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
<button class="btn-bad" onclick="clearLog()">üóë –û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª</button>
</div>

<div class="card">
<div class="highlight">üìà Equity</div>
<canvas id="equity"></canvas>
</div>

<div class="card">
<div class="highlight">üìä ROI</div>
<div id="roi"></div>
</div>

</div>

<script>
let trades = JSON.parse(localStorage.getItem('tt_trades') || '[]');
let currentBet = null;
let chart;

renderLog(); renderROI(); renderEquity();

function analyze(e){
const status=document.getElementById('status');
status.innerText='–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...';

Tesseract.recognize(e.target.files[0],'rus',{
logger:m=>{if(m.progress)status.innerText='OCR '+Math.round(m.progress*100)+'%';}
}).then(r=>{
status.innerText='–ì–æ—Ç–æ–≤–æ';
processText(r.data.text);
});
}

function processText(text){
const odds=text.match(/\d\.\d{2}/g);
if(!odds||odds.length<10){
document.getElementById('output').innerHTML='<div class="block bad">‚ùå –õ–∏–Ω–∏—è –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞</div>';return;
}

const nums=odds.map(Number);
let totals=[
{l:16.5,a:nums[2],b:nums[3]},
{l:17.5,a:nums[4],b:nums[5]},
{l:18.5,a:nums[6],b:nums[7]},
{l:19.5,a:nums[8],b:nums[9]},
{l:20.5,a:nums[10],b:nums[11]}
];

let best=null,edge=0,lbi=0,rows='';
totals.forEach(t=>{
let min=Math.min(t.a,t.b),max=Math.max(t.a,t.b);
let diff=max-min;lbi+=diff*10;
let side=t.a>t.b?'–¢–ë':'–¢–ú';
if(min>=1.70){
let prob=1/max,val=(prob*min)-1;
rows+=`<div class="row"><span>${side} ${t.l}</span><b>${min.toFixed(2)} | Œî ${diff.toFixed(2)}</b></div>`;
if(val>edge){edge=val;best={side,line:t.l,odd:min,prob,val};}
}
});
lbi=Math.min(100,Math.round(lbi));
let variance=lbi>70?'LOW':lbi>45?'MEDIUM':'HIGH';
let kelly=best?((best.prob*best.odd-1)/(best.odd-1))*0.25:0;
currentBet=best;

document.getElementById('output').innerHTML=`
<div class="row"><span>–ò–Ω–¥–µ–∫—Å –ø–µ—Ä–µ–∫–æ—Å–∞</span><b>${lbi}/100</b></div>
<div class="row"><span>–î–∏—Å–ø–µ—Ä—Å–∏—è</span><b>${variance}</b></div>
<div class="block"><div class="highlight">–¢–æ—Ç–∞–ª—ã</div>${rows}</div>
${best?`
<div class="block good">
<div class="highlight">‚≠ê –°—Ç–∞–≤–∫–∞</div>
${best.side} ${best.line} @ ${best.odd.toFixed(2)}<br>
Value: ${best.val.toFixed(3)}<br>
Kelly (¬º): ${(kelly*100).toFixed(2)}%
<button class="btn-good" onclick="addTrade()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
</div>`:`<div class="block bad">Value –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`}
`;
}

function addTrade(){
trades.push({date:new Date().toLocaleString(),bet:`${currentBet.side} ${currentBet.line}`,odd:currentBet.odd,result:null,profit:0});
save();renderLog();renderROI();renderEquity();
}

function setResult(i,r){
trades[i].result=r;
trades[i].profit=r==='win'?trades[i].odd-1:-1;
save();renderLog();renderROI();renderEquity();
}

function renderLog(){
const el=document.getElementById('tradeLog');el.innerHTML='';
trades.slice().reverse().forEach((t,i)=>{
let idx=trades.length-1-i;
el.innerHTML+=`
<div class="row">
<span>${t.bet} @ ${t.odd.toFixed(2)}</span>
${t.result?`<b style="color:${t.profit>0?'#22c55e':'#ef4444'}">${t.profit.toFixed(2)}</b>`:
`<span>
<button class="btn-good" onclick="setResult(${idx},'win')">Win</button>
<button class="btn-bad" onclick="setResult(${idx},'lose')">Lose</button>
</span>`}
</div>`;
});
}

function renderROI(){
let done=trades.filter(t=>t.result).length;
let profit=trades.reduce((a,b)=>a+b.profit,0);
document.getElementById('roi').innerHTML=`
<div class="row"><span>–°–¥–µ–ª–æ–∫</span><b>${done}</b></div>
<div class="row"><span>–ü—Ä–æ—Ñ–∏—Ç</span><b>${profit.toFixed(2)}</b></div>
<div class="row"><span>ROI</span><b>${done?(profit/done*100).toFixed(1):0}%</b></div>`;
}

function renderEquity(){
const ctx=document.getElementById('equity');
let eq=0,data=[];
trades.forEach(t=>{if(t.result){eq+=t.profit;data.push(eq);}});
if(chart)chart.destroy();
chart=new Chart(ctx,{type:'line',data:{labels:data.map((_,i)=>i+1),
datasets:[{data,fill:false,borderWidth:2}]},
options:{plugins:{legend:{display:false}},scales:{x:{display:false},y:{ticks:{color:'#9ca3af'}}}});
}

function exportCSV(){
let csv='Date,Bet,Odd,Result,Profit\n';
trades.forEach(t=>{
csv+=`${t.date},${t.bet},${t.odd},${t.result||''},${t.profit}\n`;
});
let blob=new Blob([csv],{type:'text/csv'});
let a=document.createElement('a');
a.href=URL.createObjectURL(blob);
a.download='tt_trades.csv';
a.click();
}

function clearLog(){
if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª —Å–¥–µ–ª–æ–∫?')){
trades=[];save();renderLog();renderROI();renderEquity();
}
}

function save(){localStorage.setItem('tt_trades',JSON.stringify(trades));}
</script>

</body>
</html>
