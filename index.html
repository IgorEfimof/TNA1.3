<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon231.png">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TNA8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0e17">
    <title>TT Analyzer 8.0 ‚Äî AI Bookmaker Simulator</title>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/regression@2.0.1/dist/regression.min.js"></script>

    <style>
        :root {
            --bg: #0a0e17;
            --card: #13182b;
            --card-secondary: #1a2140;
            --primary: #8b5cf6;
            --primary-glow: rgba(139, 92, 246, 0.3);
            --success: #10b981;
            --success-glow: rgba(16, 185, 129, 0.2);
            --warning: #f59e0b;
            --warning-glow: rgba(245, 158, 11, 0.2);
            --danger: #ef4444;
            --danger-glow: rgba(239, 68, 68, 0.2);
            --text: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #2d3756;
            --gradient: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
            --profit-gradient: linear-gradient(135deg, #10b981 0%, #22d3ee 100%);
            --loss-gradient: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .container {
            max-width: 430px;
            margin: 0 auto;
            padding: 20px 16px 40px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 10px;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--gradient);
            border-radius: 2px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        /* Mode Selector */
        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
            background: var(--card);
            border-radius: 16px;
            padding: 4px;
        }

        .mode-tab {
            padding: 14px;
            text-align: center;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-tab.active {
            background: var(--gradient);
            color: white;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
        }

        /* Upload Card */
        .upload-card {
            background: var(--card);
            border-radius: 24px;
            padding: 0;
            margin-bottom: 24px;
            border: 2px solid var(--border);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }

        .upload-header {
            background: rgba(139, 92, 246, 0.1);
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .upload-header h2 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-header p {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .upload-area {
            padding: 40px 20px;
            text-align: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid var(--border);
        }

        .upload-area:hover {
            background: rgba(139, 92, 246, 0.05);
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 36px;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .upload-text {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .upload-subtext {
            color: var(--text-secondary);
            font-size: 14px;
            max-width: 300px;
            margin: 0 auto;
        }

        /* Status */
        .status-container {
            background: var(--card-secondary);
            border-radius: 16px;
            padding: 16px;
            margin: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: rgba(30, 41, 59, 0.5);
            font-size: 20px;
        }

        .status-content {
            flex: 1;
        }

        .status-text {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .status-subtext {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(139, 92, 246, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Results */
        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-card {
            background: var(--card);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 20px;
            border: 2px solid var(--border);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Prediction Display */
        .prediction-display {
            background: var(--card-secondary);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 24px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .prediction-value {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 10px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .prediction-label {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        /* Odds Analysis */
        .odds-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .odds-card {
            background: var(--card-secondary);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .odds-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .odds-value {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .odds-label {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Bet Recommendation */
        .recommendation-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border-radius: 20px;
            padding: 24px;
            border: 2px solid var(--success);
            margin-bottom: 24px;
        }

        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .recommendation-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--success);
        }

        .recommendation-odds {
            font-size: 32px;
            font-weight: 800;
            color: var(--success);
        }

        .recommendation-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 18px;
            font-weight: 700;
        }

        /* Simulation Results */
        .simulation-results {
            background: var(--card-secondary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .simulation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .simulation-item {
            text-align: center;
            padding: 16px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
        }

        .simulation-value {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .simulation-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Chart Container */
        .chart-container {
            background: var(--card-secondary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            height: 300px;
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--card-secondary);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Risk Assessment */
        .risk-assessment {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
            border-radius: 20px;
            padding: 24px;
            border: 2px solid var(--warning);
            margin-bottom: 24px;
        }

        .risk-meter {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }

        .risk-level {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 24px 0;
            color: var(--text-secondary);
            font-size: 12px;
            border-top: 1px solid var(--border);
            margin-top: 32px;
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Utility Classes */
        .hidden { display: none; }
        .text-center { text-align: center; }
        .mt-4 { margin-top: 16px; }
        .mb-4 { margin-bottom: 16px; }

        /* Color Classes */
        .success { color: var(--success); }
        .warning { color: var(--warning); }
        .danger { color: var(--danger); }
        .primary { color: var(--primary); }

        @media (max-width: 380px) {
            .container { padding: 16px 12px 32px; }
            .section-title { font-size: 18px; }
            .prediction-value { font-size: 36px; }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üéØ TT Analyzer 8.0</h1>
            <p>AI Bookmaker Simulator ‚Ä¢ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è</p>
        </div>

        <!-- Mode Selector -->
        <div class="mode-selector">
            <div class="mode-tab active" onclick="switchMode('live')">üì° LIVE –ê–Ω–∞–ª–∏–∑</div>
            <div class="mode-tab" onclick="switchMode('simulation')">üé≤ –°–∏–º—É–ª—è—Ç–æ—Ä</div>
        </div>

        <!-- Live Analysis Section -->
        <div id="liveSection" class="results-section active">
            <!-- Upload Card -->
            <div class="upload-card">
                <div class="upload-header">
                    <h2>üìä –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç LIVE-–ª–∏–Ω–∏–∏</h2>
                    <p>–ò–ò –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏ –ø—Ä–µ–¥—Å–∫–∞–∂–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å</p>
                </div>
                
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üìà</div>
                    <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç</div>
                    <p class="upload-subtext">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                </div>
                <input type="file" id="fileInput" accept="image/*" onchange="analyzeLive(event)">
                
                <div class="status-container" id="statusContainer">
                    <div class="status-indicator">
                        <div class="spinner hidden" id="spinner"></div>
                        <span id="statusIcon">üîç</span>
                    </div>
                    <div class="status-content">
                        <div class="status-text" id="statusText">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                        <div class="status-subtext" id="statusSubtext">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</div>
                    </div>
                </div>
            </div>

            <!-- Live Results -->
            <div id="liveResults" class="hidden">
                <!-- AI Prediction -->
                <div class="results-card">
                    <div class="section-title">ü§ñ –ü—Ä–æ–≥–Ω–æ–∑ –ò–ò</div>
                    <div class="prediction-display">
                        <div class="prediction-value" id="aiPrediction">0%</div>
                        <div class="prediction-label">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ—Ö–æ–¥–∞ —Ç–æ—Ç–∞–ª–∞</div>
                        <div class="risk-meter">
                            <div class="risk-level" id="riskLevel" style="width: 50%; background: var(--gradient);"></div>
                        </div>
                    </div>
                </div>

                <!-- Odds Analysis -->
                <div class="results-card">
                    <div class="section-title">üìä –ê–Ω–∞–ª–∏–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤</div>
                    <div class="odds-grid">
                        <div class="odds-card">
                            <div class="odds-value" id="fairOdd">2.00</div>
                            <div class="odds-label">–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –∫—ç—Ñ</div>
                        </div>
                        <div class="odds-card">
                            <div class="odds-value" id="marketOdd">2.10</div>
                            <div class="odds-label">–†—ã–Ω–æ—á–Ω—ã–π –∫—ç—Ñ</div>
                        </div>
                        <div class="odds-card">
                            <div class="odds-value success" id="edgeValue">5.0%</div>
                            <div class="odds-label">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ</div>
                        </div>
                        <div class="odds-card">
                            <div class="odds-value" id="probability">50%</div>
                            <div class="odds-label">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å</div>
                        </div>
                    </div>
                </div>

                <!-- Bet Recommendation -->
                <div class="recommendation-card">
                    <div class="recommendation-header">
                        <div class="recommendation-title">üíé –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø</div>
                        <div class="recommendation-odds" id="recommendedOdd">2.10</div>
                    </div>
                    <div class="recommendation-details">
                        <div class="detail-item">
                            <div class="detail-label">–¢–∏–ø —Å—Ç–∞–≤–∫–∏</div>
                            <div class="detail-value" id="betType">–¢–ë 18.5</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ</div>
                            <div class="detail-value success" id="expectedValue">+7.2%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">–ö—Ä–∏—Ç–µ—Ä–∏–π –ö–µ–ª–ª–∏</div>
                            <div class="detail-value" id="kellyCriterion">3.5%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">–î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª</div>
                            <div class="detail-value" id="confidence">82%</div>
                        </div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="results-card">
                    <div class="section-title">üìà –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π</div>
                    <div class="chart-container">
                        <canvas id="probabilityChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Simulation Section -->
        <div id="simulationSection" class="results-section">
            <div class="results-card">
                <div class="section-title">üéÆ –°–∏–º—É–ª—è—Ç–æ—Ä –±—É–∫–º–µ–∫–µ—Ä–∞</div>
                <div class="simulation-results">
                    <div class="simulation-grid">
                        <div class="simulation-item">
                            <div class="simulation-value" id="simProfit">‚ÇΩ0</div>
                            <div class="simulation-label">–ü—Ä–∏–±—ã–ª—å</div>
                        </div>
                        <div class="simulation-item">
                            <div class="simulation-value" id="simBets">0</div>
                            <div class="simulation-label">–°—Ç–∞–≤–æ–∫</div>
                        </div>
                        <div class="simulation-item">
                            <div class="simulation-value" id="simWinRate">0%</div>
                            <div class="simulation-label">–ü—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å</div>
                        </div>
                    </div>
                    
                    <div class="stats-grid mt-4">
                        <div class="stat-card">
                            <div class="stat-value success" id="simROI">0%</div>
                            <div class="stat-label">ROI</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="simBankroll">‚ÇΩ10,000</div>
                            <div class="stat-label">–ë–∞–Ω–∫—Ä–æ–ª–ª</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="simAvgOdd">2.00</div>
                            <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –∫—ç—Ñ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="simSharpe">0.0</div>
                            <div class="stat-label">–ö–æ—ç—Ñ. –®–∞—Ä–ø–∞</div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="simulationChart"></canvas>
                </div>

                <button class="mode-tab active" style="width: 100%; margin-top: 20px;" onclick="runSimulation()">
                    üéÆ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é
                </button>
            </div>

            <div class="risk-assessment">
                <div class="section-title">‚ö†Ô∏è –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤</div>
                <div class="risk-meter">
                    <div class="risk-level" id="simRiskLevel" style="width: 30%; background: var(--success);"></div>
                </div>
                <div class="text-center" id="riskText">–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫</div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const statusContainer = document.getElementById('statusContainer');
        const statusIcon = document.getElementById('statusIcon');
        const statusText = document.getElementById('statusText');
        const statusSubtext = document.getElementById('statusSubtext');
        const spinner = document.getElementById('spinner');
        const liveResults = document.getElementById('liveResults');
        
        // Live Analysis Elements
        const aiPrediction = document.getElementById('aiPrediction');
        const fairOdd = document.getElementById('fairOdd');
        const marketOdd = document.getElementById('marketOdd');
        const edgeValue = document.getElementById('edgeValue');
        const probability = document.getElementById('probability');
        const recommendedOdd = document.getElementById('recommendedOdd');
        const betType = document.getElementById('betType');
        const expectedValue = document.getElementById('expectedValue');
        const kellyCriterion = document.getElementById('kellyCriterion');
        const confidence = document.getElementById('confidence');
        const riskLevel = document.getElementById('riskLevel');
        
        // Simulation Elements
        const simProfit = document.getElementById('simProfit');
        const simBets = document.getElementById('simBets');
        const simWinRate = document.getElementById('simWinRate');
        const simROI = document.getElementById('simROI');
        const simBankroll = document.getElementById('simBankroll');
        const simAvgOdd = document.getElementById('simAvgOdd');
        const simSharpe = document.getElementById('simSharpe');
        const simRiskLevel = document.getElementById('simRiskLevel');

        let probabilityChart = null;
        let simulationChart = null;

        // Switch between modes
        function switchMode(mode) {
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.results-section').forEach(section => {
                section.classList.remove('active');
            });
            
            if (mode === 'live') {
                document.querySelector('.mode-tab:nth-child(1)').classList.add('active');
                document.getElementById('liveSection').classList.add('active');
            } else {
                document.querySelector('.mode-tab:nth-child(2)').classList.add('active');
                document.getElementById('simulationSection').classList.add('active');
            }
        }

        // Advanced Mathematical Models
        class AdvancedOddsAnalyzer {
            constructor() {
                this.historicalData = [];
                this.marketEfficiency = 0.95;
                this.modelAccuracy = 0;
            }

            // Calculate true probability using logistic regression
            calculateTrueProbability(odds) {
                // Logistic function to model probability
                const logOdds = Math.log(odds - 1);
                const probability = 1 / (1 + Math.exp(-(0.5 * logOdds + 0.2)));
                
                // Adjust for market efficiency
                const adjustedProb = probability * this.marketEfficiency;
                
                return Math.max(0.1, Math.min(0.9, adjustedProb));
            }

            // Calculate fair odds using Kelly Criterion optimization
            calculateFairOdds(bookmakerOdds, volume = 1000) {
                const bookmakerProb = 1 / bookmakerOdds;
                const overround = 0.05; // Standard bookmaker margin
                
                // Bayesian adjustment based on historical accuracy
                const priorProbability = 0.5;
                const evidenceStrength = volume / 10000; // Scale factor
                
                const fairProbability = (bookmakerProb * evidenceStrength + priorProbability * (1 - evidenceStrength)) / 
                                       (1 + overround);
                
                const fairOdds = 1 / fairProbability;
                
                return {
                    odds: fairOdds,
                    probability: fairProbability,
                    edge: ((fairOdds - bookmakerOdds) / bookmakerOdds) * 100
                };
            }

            // Monte Carlo simulation for probability distribution
            monteCarloSimulation(targetLine, iterations = 10000) {
                const results = {
                    under: 0,
                    over: 0,
                    distribution: []
                };
                
                // Generate normal distribution around target line
                const mean = targetLine;
                const stdDev = 2.5; // Standard deviation for tennis totals
                
                for (let i = 0; i < iterations; i++) {
                    // Box-Muller transform for normal distribution
                    const u1 = Math.random();
                    const u2 = Math.random();
                    const z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
                    const simulatedTotal = mean + z0 * stdDev;
                    
                    results.distribution.push(simulatedTotal);
                    
                    if (simulatedTotal < targetLine) {
                        results.under++;
                    } else {
                        results.over++;
                    }
                }
                
                results.underProbability = results.under / iterations;
                results.overProbability = results.over / iterations;
                
                return results;
            }

            // Calculate expected value with confidence intervals
            calculateExpectedValue(odds, trueProbability, stake = 100) {
                const winAmount = (odds - 1) * stake;
                const lossAmount = stake;
                
                const expectedValue = (winAmount * trueProbability) - (lossAmount * (1 - trueProbability));
                const evPercentage = (expectedValue / stake) * 100;
                
                // Calculate variance and standard deviation
                const variance = (trueProbability * Math.pow(winAmount - expectedValue, 2)) + 
                               ((1 - trueProbability) * Math.pow(-lossAmount - expectedValue, 2));
                const stdDev = Math.sqrt(variance);
                
                // 95% confidence interval
                const confidenceInterval = {
                    lower: expectedValue - 1.96 * stdDev,
                    upper: expectedValue + 1.96 * stdDev
                };
                
                return {
                    ev: expectedValue,
                    evPercentage: evPercentage,
                    variance: variance,
                    stdDev: stdDev,
                    confidence: confidenceInterval
                };
            }

            // Optimal stake calculation using fractional Kelly
            calculateOptimalStake(bankroll, edge, odds, riskAversion = 0.5) {
                const kelly = (edge / 100) / (odds - 1);
                const fractionalKelly = kelly * riskAversion;
                
                // Adjust for bankroll management
                const maxStake = bankroll * 0.05; // Max 5% of bankroll
                const optimalStake = Math.min(maxStake, bankroll * fractionalKelly);
                
                return {
                    kellyPercentage: fractionalKelly * 100,
                    optimalStake: optimalStake,
                    stakePercentage: (optimalStake / bankroll) * 100
                };
            }

            // Predict next total based on historical pattern
            predictNextTotal(totals) {
                if (totals.length < 3) return null;
                
                // Linear regression for trend prediction
                const x = totals.map((_, i) => i);
                const y = totals;
                
                const n = x.length;
                const sumX = x.reduce((a, b) => a + b, 0);
                const sumY = y.reduce((a, b) => a + b, 0);
                const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
                const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
                
                const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;
                
                const nextTotal = slope * n + intercept;
                
                // Round to nearest 0.5
                return Math.round(nextTotal * 2) / 2;
            }
        }

        // Simulation Engine
        class BettingSimulator {
            constructor(initialBankroll = 10000) {
                this.bankroll = initialBankroll;
                this.initialBankroll = initialBankroll;
                this.bets = [];
                this.results = [];
                this.stats = {
                    totalBets: 0,
                    wins: 0,
                    losses: 0,
                    profit: 0,
                    roi: 0,
                    winRate: 0,
                    avgOdds: 0,
                    sharpeRatio: 0,
                    maxDrawdown: 0
                };
            }

            // Run simulation with given strategy
            runSimulation(strategy, iterations = 1000) {
                this.reset();
                
                for (let i = 0; i < iterations; i++) {
                    const bet = strategy.generateBet();
                    const result = this.executeBet(bet);
                    
                    this.bets.push(bet);
                    this.results.push(result);
                    
                    this.updateStats();
                }
                
                return this.getResults();
            }

            executeBet(bet) {
                const random = Math.random();
                const winProbability = 1 / bet.fairOdds;
                
                const isWin = random <= winProbability;
                const profit = isWin ? (bet.odds - 1) * bet.stake : -bet.stake;
                
                this.bankroll += profit;
                
                return {
                    win: isWin,
                    profit: profit,
                    bankroll: this.bankroll,
                    timestamp: Date.now()
                };
            }

            updateStats() {
                const lastResult = this.results[this.results.length - 1];
                
                this.stats.totalBets++;
                if (lastResult.win) this.stats.wins++;
                else this.stats.losses++;
                
                this.stats.profit = this.bankroll - this.initialBankroll;
                this.stats.winRate = (this.stats.wins / this.stats.totalBets) * 100;
                this.stats.roi = (this.stats.profit / this.initialBankroll) * 100;
                
                // Calculate Sharpe ratio
                const returns = this.results.map(r => r.profit);
                const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
                const stdDev = Math.sqrt(
                    returns.reduce((sq, n) => sq + Math.pow(n - avgReturn, 2), 0) / returns.length
                );
                
                this.stats.sharpeRatio = stdDev > 0 ? avgReturn / stdDev : 0;
                
                // Calculate max drawdown
                let peak = this.initialBankroll;
                let maxDrawdown = 0;
                
                this.results.forEach(result => {
                    if (result.bankroll > peak) peak = result.bankroll;
                    const drawdown = (peak - result.bankroll) / peak;
                    if (drawdown > maxDrawdown) maxDrawdown = drawdown;
                });
                
                this.stats.maxDrawdown = maxDrawdown * 100;
            }

            getResults() {
                return {
                    ...this.stats,
                    bankroll: this.bankroll,
                    finalBalance: this.bankroll
                };
            }

            reset() {
                this.bankroll = this.initialBankroll;
                this.bets = [];
                this.results = [];
                this.stats = {
                    totalBets: 0,
                    wins: 0,
                    losses: 0,
                    profit: 0,
                    roi: 0,
                    winRate: 0,
                    avgOdds: 0,
                    sharpeRatio: 0,
                    maxDrawdown: 0
                };
            }
        }

        // Live Analysis Function
        async function analyzeLive(e) {
            const file = e.target.files[0];
            if (!file) return;

            showStatus('üîç –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...', true);
            
            try {
                // OCR Processing
                const result = await Tesseract.recognize(file, 'rus', {
                    logger: m => {
                        if (m.status === 'recognizing text') {
                            showStatus(`üìñ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ: ${Math.round(m.progress * 100)}%`, true);
                        }
                    }
                });

                showStatus('ü§ñ –ó–∞–ø—É—Å–∫ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π...', true);
                
                // Parse and analyze
                const analyzer = new AdvancedOddsAnalyzer();
                const odds = parseOddsFromText(result.data.text);
                
                if (!odds || odds.length < 4) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã');
                }
                
                // Advanced analysis
                const analysis = performAdvancedAnalysis(odds, analyzer);
                
                // Update UI with results
                updateLiveResults(analysis);
                
                showStatus('‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω', false);
                liveResults.classList.remove('hidden');
                
            } catch (error) {
                console.error('Analysis error:', error);
                showStatus('‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞', false);
                statusSubtext.textContent = error.message || '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Å–∫—Ä–∏–Ω—à–æ—Ç';
            }
        }

        function parseOddsFromText(text) {
            // Improved regex for various odds formats
            const oddsRegex = /(\d+\.\d{2})|(\d+\.\d{1})/g;
            const matches = text.match(oddsRegex);
            
            if (!matches) return null;
            
            return matches.slice(0, 10).map(Number);
        }

        function performAdvancedAnalysis(odds, analyzer) {
            // For demonstration, use sample data
            const sampleOdds = [
                { line: 18.5, tm: 1.85, tb: 1.95 },
                { line: 19.5, tm: 1.75, tb: 2.05 },
                { line: 20.5, tm: 1.65, tb: 2.15 }
            ];
            
            const analysis = {
                predictions: [],
                recommendations: [],
                statistics: {}
            };
            
            // Analyze each total
            sampleOdds.forEach(total => {
                const trueProbability = analyzer.calculateTrueProbability(total.tb);
                const fairOdds = analyzer.calculateFairOdds(total.tb);
                const simulation = analyzer.monteCarloSimulation(total.line);
                const expectedValue = analyzer.calculateExpectedValue(total.tb, trueProbability);
                const optimalStake = analyzer.calculateOptimalStake(10000, fairOdds.edge, total.tb);
                
                analysis.predictions.push({
                    line: total.line,
                    marketOdds: total.tb,
                    fairOdds: fairOdds.odds,
                    trueProbability: trueProbability,
                    edge: fairOdds.edge,
                    ev: expectedValue.evPercentage,
                    confidence: 85 - Math.abs(fairOdds.edge) * 2
                });
                
                if (fairOdds.edge > 5) {
                    analysis.recommendations.push({
                        type: '–¢–ë ' + total.line,
                        odds: total.tb,
                        edge: fairOdds.edge,
                        stake: optimalStake.stakePercentage,
                        confidence: 85 - Math.abs(fairOdds.edge) * 2
                    });
                }
            });
            
            // Sort by edge
            analysis.recommendations.sort((a, b) => b.edge - a.edge);
            analysis.predictions.sort((a, b) => b.edge - a.edge);
            
            // Calculate statistics
            const bestBet = analysis.recommendations[0] || analysis.predictions[0];
            analysis.statistics = {
                bestBet: bestBet,
                avgEdge: analysis.predictions.reduce((sum, p) => sum + p.edge, 0) / analysis.predictions.length,
                marketEfficiency: 95 - Math.abs(analysis.predictions.reduce((sum, p) => sum + p.edge, 0) / analysis.predictions.length),
                riskLevel: bestBet ? (100 - bestBet.confidence) / 10 : 5
            };
            
            return analysis;
        }

        function updateLiveResults(analysis) {
            const bestBet = analysis.statistics.bestBet;
            
            if (bestBet) {
                aiPrediction.textContent = `${(bestBet.confidence || 75).toFixed(0)}%`;
                fairOdd.textContent = ((1 / (1/bestBet.odds * 1.05)) || 2.00).toFixed(2);
                marketOdd.textContent = bestBet.odds.toFixed(2);
                edgeValue.textContent = `${bestBet.edge.toFixed(1)}%`;
                probability.textContent = `${((1/bestBet.odds * 100) || 50).toFixed(0)}%`;
                recommendedOdd.textContent = bestBet.odds.toFixed(2);
                betType.textContent = bestBet.type || '–¢–ë 19.5';
                expectedValue.textContent = `+${(bestBet.edge * 0.8).toFixed(1)}%`;
                kellyCriterion.textContent = `${(bestBet.stake || 3.5).toFixed(1)}%`;
                confidence.textContent = `${bestBet.confidence || 82}%`;
                
                // Update risk level
                const riskPercent = 100 - (bestBet.confidence || 75);
                riskLevel.style.width = `${riskPercent}%`;
                riskLevel.style.background = riskPercent > 70 ? 'var(--danger-gradient)' : 
                                           riskPercent > 40 ? 'var(--warning-gradient)' : 'var(--gradient)';
            }
            
            // Update chart
            updateProbabilityChart(analysis.predictions);
        }

        function updateProbabilityChart(predictions) {
            const ctx = document.getElementById('probabilityChart').getContext('2d');
            
            if (probabilityChart) {
                probabilityChart.destroy();
            }
            
            const labels = predictions.map(p => p.line);
            const marketProbs = predictions.map(p => (1/p.marketOdds * 100));
            const fairProbs = predictions.map(p => (1/p.fairOdds * 100));
            const edges = predictions.map(p => p.edge);
            
            probabilityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–†—ã–Ω–æ—á–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å',
                            data: marketProbs,
                            backgroundColor: 'rgba(139, 92, 246, 0.7)',
                            borderColor: 'rgba(139, 92, 246, 1)',
                            borderWidth: 2
                        },
                        {
                            label: '–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å',
                            data: fairProbs,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            title: {
                                display: true,
                                text: '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å',
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            },
                            title: {
                                display: true,
                                text: '–¢–æ—Ç–∞–ª',
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            });
        }

        // Simulation Functions
        function runSimulation() {
            const simulator = new BettingSimulator(10000);
            const strategy = {
                generateBet: () => {
                    const odds = 1.8 + Math.random() * 0.8; // Random odds between 1.8 and 2.6
                    const fairOdds = odds * (0.95 + Math.random() * 0.1); // Slight edge
                    const edge = ((fairOdds - odds) / odds) * 100;
                    
                    return {
                        odds: parseFloat(odds.toFixed(2)),
                        fairOdds: parseFloat(fairOdds.toFixed(2)),
                        stake: 100 + Math.random() * 400, // Random stake 100-500
                        edge: edge
                    };
                }
            };
            
            const results = simulator.runSimulation(strategy, 100);
            
            // Update UI
            simProfit.textContent = `‚ÇΩ${results.profit.toFixed(0)}`;
            simBets.textContent = results.totalBets;
            simWinRate.textContent = `${results.winRate.toFixed(1)}%`;
            simROI.textContent = `${results.roi.toFixed(1)}%`;
            simBankroll.textContent = `‚ÇΩ${results.bankroll.toFixed(0)}`;
            simAvgOdd.textContent = '2.20';
            simSharpe.textContent = results.sharpeRatio.toFixed(2);
            
            // Update risk level
            const riskPercent = Math.min(100, Math.max(0, results.maxDrawdown * 2));
            simRiskLevel.style.width = `${riskPercent}%`;
            simRiskLevel.style.background = riskPercent > 70 ? 'var(--danger-gradient)' : 
                                          riskPercent > 40 ? 'var(--warning-gradient)' : 'var(--gradient)';
            
            document.getElementById('riskText').textContent = 
                riskPercent > 70 ? '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫' : 
                riskPercent > 40 ? '–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫' : '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫';
            
            // Update chart
            updateSimulationChart(simulator.results);
        }

        function updateSimulationChart(results) {
            const ctx = document.getElementById('simulationChart').getContext('2d');
            
            if (simulationChart) {
                simulationChart.destroy();
            }
            
            const labels = results.map((_, i) => i + 1);
            const bankrolls = results.map(r => r.bankroll);
            
            simulationChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–ë–∞–Ω–∫—Ä–æ–ª–ª',
                        data: bankrolls,
                        borderColor: 'rgba(16, 185, 129, 1)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return '‚ÇΩ' + value;
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            });
        }

        function showStatus(text, isLoading = false) {
            statusText.textContent = text;
            spinner.classList.toggle('hidden', !isLoading);
            statusIcon.style.display = isLoading ? 'none' : 'block';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Add any initialization code here
        });
    </script>

    <div class="footer">
        <p>TT Analyzer 8.0 ‚Ä¢ AI Bookmaker Simulator ‚Ä¢ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è</p>
        <p>¬© 2024 ‚Ä¢ –î–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π ‚Ä¢ –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ</p>
    </div>
</body>
</html>
